name: Procesar Notificaciones de Mantenimiento

# Este workflow se ejecuta automÃ¡ticamente todos los dÃ­as a las 8:00 AM hora de Colombia (13:00 UTC)
# TambiÃ©n permite ejecuciÃ³n manual desde la pestaÃ±a "Actions" en GitHub

on:
  # ProgramaciÃ³n automÃ¡tica
  schedule:
    - cron: '0 13 * * *'  # 8:00 AM Colombia (UTC-5)
  
  # Permite ejecutar manualmente desde GitHub Actions UI
  workflow_dispatch:

jobs:
  procesar-notificaciones:
    runs-on: ubuntu-latest
    
    steps:
      - name: Llamar API de procesamiento de mantenimiento
        run: |
          echo "ðŸ”„ Procesando notificaciones de mantenimiento..."
          
          response=$(curl -s -w "\n%{http_code}" -X GET "${{ secrets.APP_URL }}/api/mantenimiento/procesar" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET_TOKEN }}" \
            -H "Content-Type: application/json")
          
          http_code=$(echo "$response" | tail -n1)
          body=$(echo "$response" | head -n-1)
          
          echo "HTTP Status: $http_code"
          echo "Response Body: $body"
          
          if [ "$http_code" -eq 200 ] || [ "$http_code" -eq 207 ]; then
            echo "âœ… Procesamiento completado exitosamente"
            exit 0
          else
            echo "âŒ Error al procesar notificaciones"
            exit 1
          fi
      
      - name: Notificar resultado (opcional)
        if: failure()
        run: |
          echo "âŒ El procesamiento de notificaciones fallÃ³. Revisa los logs."
          # AquÃ­ puedes agregar notificaciones adicionales (Slack, Discord, Email, etc.)

# ConfiguraciÃ³n de secretos requeridos en GitHub:
# 1. Ve a Settings > Secrets and variables > Actions
# 2. Agrega estos secretos:
#    - APP_URL: https://tu-sitio-admin.com
#    - CRON_SECRET_TOKEN: tu-token-secreto-aleatorio
